<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zfit.util.execution &#8212; zfit 0.5.4.dev5+gcaab824 documentation</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-2.3.2/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../../../index.html"><img src="../../../_static/zfit-fin_57x24.png">
          zfit</a>
        <span class="navbar-text pull-left"><b>0.5.4.dev5</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../../../getting_started.html">Getting started</a></li>
                <li><a href="../../../introduction.html">Intro</a></li>
                <li><a href="../../../project.html">Project</a></li>
                <li><a href="../../../user_api.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Overview <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started.html#what-did-just-happen">What did just happen?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">zfit introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../intro/space.html">Space, Observable and Range</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/space.html#definitions">Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/space.html#limits">Limits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../intro/space.html#functional-limits">Functional limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../intro/space.html#combining-limits">Combining limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../intro/space.html#using-the-limits">Using the limits</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../intro/parameter.html">Parameter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/parameter.html#independent-parameter">Independent Parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/parameter.html#dependent-parameter">Dependent Parameter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../intro/model.html">Building a model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/model.html#predefined-pdfs-and-basic-properties">Predefined PDFs and basic properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/model.html#composite-pdf">Composite PDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/model.html#extended-pdf">Extended PDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/model.html#custom-pdf">Custom PDF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../intro/model.html#sampling-from-a-model">Sampling from a Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../intro/model.html#tensor-sampling">Tensor sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../intro/model.html#playing-with-toys-multiple-samplings">Playing with toys: Multiple samplings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../intro/data.html">Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/data.html#import-dataset-from-a-root-file">Import dataset from a ROOT file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/data.html#import-dataset-from-a-pandas-dataframe-or-numpy-ndarray">Import dataset from a pandas DataFrame or Numpy ndarray</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../intro/loss.html">Loss</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/loss.html#adding-constraints">Adding constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/loss.html#simultaneous-fits">Simultaneous fits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../intro/minimize.html">Minimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../intro/minimize.html#baseline-minimizers">Baseline minimizers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../project.html">zfit Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../project/installation.html">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../project/installation.html#stable-release">Stable release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/installation.html#from-sources">From sources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../project/contributing.html">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../project/contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/contributing.html#pull-request-guidelines">Pull Request Guidelines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../project/upgrade_guide.html">Upgrade guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../project/upgrade_guide.html#upgrade-from-zfit-0-3-x-to-0-4-0">Upgrade from zfit 0.3.x to 0.4.0</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/upgrade_guide.html#dependents">Dependents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../project/changelog.html">Changelog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#develop">Develop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#major-features-and-improvements">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#breaking-changes">Breaking changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#depreceations">Depreceations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#bug-fixes-and-small-changes">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#experimental">Experimental</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#requirement-changes">Requirement changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#thanks">Thanks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id1">0.5.3 (02.07.20)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id2">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id3">Breaking changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id4">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id5">Requirement changes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id6">0.5.2 (13.05.2020)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id7">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id8">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id9">Requirement changes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id10">0.5.1 (24.04.2020)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id11">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id12">Breaking changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#deprecations">Deprecations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id13">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id14">Experimental</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id15">Requirement changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id16">Thanks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id17">0.4.3 (11.3.2020)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id18">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#behavioral-changes">Behavioral changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id19">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id20">Requirement changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id21">Thanks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id22">0.4.2 (27.2.2020)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id23">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id24">Behavioral changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id25">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id26">Requirement changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id27">Thanks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id28">0.4.1 (12.1.20)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id29">Major Features and Improvements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id30">0.4.0 (7.1.2020)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id31">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id32">Behavioral changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id33">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id34">Requirement changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id35">Thanks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id36">0.3.7 (6.12.19)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id37">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id38">Behavioral changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id39">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id40">Requirement changes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id41">0.3.6 (12.10.19)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id42">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id43">Behavioral changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id44">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id45">Requirement changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id46">Thanks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id47">0.3.4 (30-07-19)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id48">Major Features and Improvements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id49">Behavioral changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id50">Bug fixes and small changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id51">Thanks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id52">0.3.3 (15-05-19)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id53">0.3.2 (01-05-19)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#id54">Breaking changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#bugfixes">Bugfixes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../project/changelog.html#improvements">Improvements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id55">0.3.1 (30-04-19)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id56">0.3.0 (2019-03-20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../project/changelog.html#id57">0.0.1 (2018-03-22)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../project/authors.html">Development Lead</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../project/authors.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../project/authors.html#contributors">Contributors</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_api.html">zfit API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user_api/zfit.html">zfit package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user_api/zfit.html#submodules">Submodules</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <h1>Source code for zfit.util.execution</h1><div class="highlight"><pre>
<span></span><span class="c1">#  Copyright (c) 2020 zfit</span>

<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="kn">from</span> <span class="nn">.container</span> <span class="kn">import</span> <span class="n">DotDict</span>
<span class="kn">from</span> <span class="nn">.exception</span> <span class="kn">import</span> <span class="n">IllegalInGraphModeError</span>
<span class="kn">from</span> <span class="nn">.legacy</span> <span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">.temporary</span> <span class="kn">import</span> <span class="n">TemporarilySet</span>


<div class="viewcode-block" id="RunManager"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager">[docs]</a><span class="k">class</span> <span class="nc">RunManager</span><span class="p">:</span>
    <span class="n">DEFAULT_MODE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;graph&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;autograd&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_cpu</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle the resources and runtime specific options. The `run` method is equivalent to `sess.run`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_CHUNK_SIZE</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunking</span> <span class="o">=</span> <span class="n">DotDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cpu</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_cpu</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inter_cpus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intra_cpus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_strict</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numeric_checks</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_MODE</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_n_cpu</span><span class="p">(</span><span class="n">n_cpu</span><span class="o">=</span><span class="n">n_cpu</span><span class="p">)</span>

        <span class="c1"># HACK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_parameter_autoconversion</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># HACK END</span>

        <span class="c1"># set default values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunking</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># not yet implemented the chunking...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunking</span><span class="o">.</span><span class="n">max_n_points</span> <span class="o">=</span> <span class="mi">1000000</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunksize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunking</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunking</span><span class="o">.</span><span class="n">max_n_points</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_CHUNK_SIZE</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cpu</span><span class="p">)</span>

<div class="viewcode-block" id="RunManager.set_n_cpu"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.set_n_cpu">[docs]</a>    <span class="k">def</span> <span class="nf">set_n_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_cpu</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set the number of cpus to be used by zfit. For more control, use `set_cpus_explicit`.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_cpu: Number of cpus, will be the number for inter-op parallelism</span>
<span class="sd">            strict: If strict, sets intra parallelism to 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_cpu</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cpu</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sched_getaffinity</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">cpu</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">())</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Not running on Linux. Determining available cpus for thread can fail&quot;</span>
                              <span class="s2">&quot;and be overestimated. Workaround (only if too many cpus are used):&quot;</span>
                              <span class="s2">&quot;`zfit.run.set_n_cpu(your_cpu_number)`&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_cpu</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">cpu</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cpu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cpu</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dummy_cpu</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cpu</span><span class="p">]</span>
        <span class="n">n_cpu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">strict</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict</span><span class="p">:</span>
            <span class="n">intra</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">strict</span> <span class="k">else</span> <span class="mi">2</span>
            <span class="n">inter</span> <span class="o">=</span> <span class="n">n_cpu</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cpus_explicit</span><span class="p">(</span><span class="n">intra</span><span class="o">=</span><span class="n">intra</span><span class="p">,</span> <span class="n">inter</span><span class="o">=</span><span class="n">inter</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunManager.set_cpus_explicit"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.set_cpus_explicit">[docs]</a>    <span class="k">def</span> <span class="nf">set_cpus_explicit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intra</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inter</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set the number of threads (cpus) used for inter-op and intra-op parallelism</span>

<span class="sd">        Args:</span>
<span class="sd">            intra: Number of threads used to perform an operation. For larger operations, e.g. large Tensors, this</span>
<span class="sd">                is usually beneficial to have &gt;= 2.</span>
<span class="sd">            inter: Parallelization on the level of ops. This is beneficial, if many operations can be computed</span>
<span class="sd">                independently in parallel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">threading</span><span class="o">.</span><span class="n">set_intra_op_parallelism_threads</span><span class="p">(</span><span class="n">intra</span><span class="p">)</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">threading</span><span class="o">.</span><span class="n">set_inter_op_parallelism_threads</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_cpu</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">intra</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot set the number of cpus after initialization, has to be at the beginning.&quot;</span>
                               <span class="sa">f</span><span class="s2">&quot; Original message: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunManager.aquire_cpu"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.aquire_cpu">[docs]</a>    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">aquire_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_cpu</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_cpu</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">max_cpu</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_cpu</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cpu</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">max_cpu</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># -1 means all</span>
            <span class="k">if</span> <span class="n">max_cpu</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cpu</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_cpu</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">max_cpu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cpu</span><span class="p">))</span>

                <span class="n">cpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu</span><span class="p">[</span><span class="o">-</span><span class="n">n_cpu</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu</span><span class="p">[:</span><span class="o">-</span><span class="n">n_cpu</span><span class="p">]</span>

            <span class="k">yield</span> <span class="n">cpu</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cpu</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Why kwargs provided?&quot;</span><span class="p">)</span>

        <span class="n">flattened_args</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">evaluated_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">eval_object</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">flattened_args</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">pack_sequence_as</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">flat_sequence</span><span class="o">=</span><span class="n">evaluated_args</span><span class="p">)</span>

        <span class="c1"># was_container = is_container(args[0]) and not isinstance(args[0], np.ndarray, )</span>
        <span class="c1"># if not was_container and values:</span>
        <span class="c1">#     values = values[0]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">values</span>

<div class="viewcode-block" id="RunManager.experimental_enable_eager"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.experimental_enable_eager">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;Use `set_graph_mode(False)`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">experimental_enable_eager</span><span class="p">(</span><span class="n">eager</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECEATED! Enable eager makes tensorflow run like numpy. Useful for debugging.</span>

<span class="sd">        Do NOT directly mix it with Numpy (and if, also enable the numberical gradient).</span>

<span class="sd">        This can BREAK in the future.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.graph</span> <span class="kn">import</span> <span class="n">jit</span>
        <span class="n">jit</span><span class="o">.</span><span class="n">_set_all</span><span class="p">(</span><span class="ow">not</span> <span class="n">eager</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunManager.set_graph_mode"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.set_graph_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_graph_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the policy for graph building and the usage of automatic vs numerical gradients.</span>

<span class="sd">            zfit runs on top of TensorFlow, a modern, powerful computing engine very similar in design to Numpy.</span>
<span class="sd">            An interactive tutorial can be found at https://github.com/zfit/zfit-tutorials</span>

<span class="sd">            **Graph building**</span>

<span class="sd">            It has two ways to be run where the first</span>
<span class="sd">            defaults to the normal mode we are in except inside a :py:func:`~zfit.z.function` decorated function. Setting</span>
<span class="sd">            the mode allows to control the behavior of decorated functions to not always trigger a graph building.</span>

<span class="sd">             - **numpy-like/eager**: in this mode, the syntax slightly differs from pure numpy but is similar. For example,</span>
<span class="sd">                `tf.sqrt`, `tf.math.log` etc. The return values are `EagerTensors` that represent &quot;wrapped Numpy arrays&quot; and</span>
<span class="sd">                can directly be used with any Numpy function. They can explicitly be converted to a Numpy array with</span>
<span class="sd">                `zfit.run(EagerTensor)`, which takes also care of nested structures and already existing `np.ndarrays`,</span>
<span class="sd">                or just a `.numpy()` method.</span>
<span class="sd">                The difference to Numpy is that TensorFlow tries to optimize the calculation slightly beforehand and may</span>
<span class="sd">                also executes on the GPU. This will result in a slight performance penalty for *very small* computations</span>
<span class="sd">                compared to Numpy, on the other hand an improved performance for larger computations.</span>

<span class="sd">             - **graph**: a function can be decorated with :py:func:`~zfit.z.function`, which will *not* execute its</span>
<span class="sd">                content immediately, but first trace it and build a graph. This is done by *recording all `tf.*` operations</span>
<span class="sd">                and adding them to the graph while any Python operation, e.g. `np.random.*` will use a fixed value added</span>
<span class="sd">                to the graph. Building a graph greatly reduces the flexibility, since only `tf.*` operations can</span>
<span class="sd">                effectively be used to have dynamics in there, on the other hand it can greatly increase the performance.</span>
<span class="sd">                When the graph is built, it is cached (for later re-use), optimized and then executed.</span>
<span class="sd">                Calling a `tf.function` decorated</span>
<span class="sd">                function does therefore not make an actualy difference *for the caller*. But it is a difference on how the</span>
<span class="sd">                function behaves.</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    @z.function</span>
<span class="sd">                    def add_rnd(x):</span>
<span class="sd">                         res1 = x + np.random.uniform()  # returns a Python scalar. This exact scalar will be constant</span>
<span class="sd">                         res2 = x + z.random.uniform(shape=())  # returns a tf.Tensor. This will be flexible</span>
<span class="sd">                         return res1, res2</span>

<span class="sd">                    res_np1, res_tf1 = add_rnd(5)</span>
<span class="sd">                    res_np2, res_tf2 = add_rnd(5)</span>

<span class="sd">                    assert res_np1 == res_np2  # they will be the same!</span>
<span class="sd">                    assert res_tf1 != res_tf2  # these differ</span>

<span class="sd">                While writing TensorFlow is just like Numpy, if we build a graph, only `tf.*` dynamics &quot;survives&quot;.</span>
<span class="sd">                Important: while values are usually constant, changing a :py:class:`zfit.Parameter` value with</span>
<span class="sd">                :py:meth:`~zfit.Parameter.set_value(...)` *will* change the value in the graph as well.</span>

<span class="sd">                            .. code-block:: python</span>

<span class="sd">                    @z.function</span>
<span class="sd">                    def add(x, param):</span>
<span class="sd">                         return x + param</span>

<span class="sd">                    param = zfit.Parameter(&#39;param1&#39;, 36)</span>
<span class="sd">                    assert add_rnd(5, param) == 41</span>
<span class="sd">                    param.set_value(6)</span>
<span class="sd">                    assert add_rnd(5, param) == 42  # the value changed!</span>

<span class="sd">                Every graph generation takes some additional time and is stored, consuming memory and slowing down the</span>
<span class="sd">                overall execution process.</span>
<span class="sd">                To clear all caches and force a rebuild of the graph, `zfit.run.clear_graph_cache()` can be used.</span>

<span class="sd">                If a function is not decorated with `z.function`, this does not guarantee that it is executed in eager,</span>
<span class="sd">                as an outer function may uses a decorator. A typical case is the loss, which is decorated. Therefore,</span>
<span class="sd">                any Model called inside will be evaluated with a graph building first.</span>


<span class="sd">                **When to use what**:</span>
<span class="sd">                 - Any repeated call (as a typical call to the loss function in the minimization process) is usually</span>
<span class="sd">                   better suited within a `z.function`.</span>
<span class="sd">                 - A single call (e.g. for plotting) or repeated calls *with different arguments* should rather be run</span>
<span class="sd">                   *without* a graph built first</span>
<span class="sd">                 - Debugging is usually way easier without graph building. Therefore, set the graph mode to `False`</span>
<span class="sd">                 - If the minimization fails but the pdf works without graph, maybe the graph mode can be switched on</span>
<span class="sd">                   for everything to have the same behavior in the pdf as when the loss is called.</span>

<span class="sd">            Args:</span>
<span class="sd">                graph: Policy for when to build a graph with which function. Currently allowed values are</span>
<span class="sd">                  - `True`: this will make all :py:func:`zfit.z.function` decorated function to be traced. Useful</span>
<span class="sd">                    to have a consistent behavior overall, as e.g. a PDF may not be traced if `pdf` or `integrate` is</span>
<span class="sd">                    called, but may be traced when inside a loss.</span>
<span class="sd">                  - `False`: this will make everything execute immediately, like Numpy (this is **not enough** to be</span>
<span class="sd">                    fully Numpy compatible in the sense of using `, also see the `autograd` option)</span>
<span class="sd">                  - &#39;auto&#39;: Something in between, where sampling (currently) and the loss builds a graph but</span>
<span class="sd">                    all model methods, such as `pdf`, `integrate` (except of `*sample*`) do not and are executed</span>
<span class="sd">                    eagerly.</span>
<span class="sd">                  - (**advanced and experimental!**): a dictionary containing the string of a wrapped function identifier</span>
<span class="sd">                    (see also :py:func:`~zfit.z.function` for more information about this) with a boolean that switches</span>
<span class="sd">                    explicitly on/off the graph building for this type of decorated functions.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">IllegalInGraphModeError</span><span class="p">(</span><span class="s2">&quot;Cannot change the execution mode of graph inside a `z.function`&quot;</span>
                                          <span class="s2">&quot; decorated function. Only possible in an eager context.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TemporarilySet</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_graph_mode</span><span class="p">,</span> <span class="n">getter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_graph_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunManager.set_autograd_mode"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.set_autograd_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_autograd_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">autograd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use automatic or numerical gradients.</span>

<span class="sd">            zfit runs on top of TensorFlow, a modern, powerful computing engine very similar in design to Numpy.</span>
<span class="sd">            An interactive tutorial can be found at https://github.com/zfit/zfit-tutorials</span>

<span class="sd">            **automatic gradient**</span>

<span class="sd">            A strong feature of TensorFlow is the possibility to derive an analytic expression for the gradient</span>
<span class="sd">            by successively applying the chain rule to all of its operations. This is *independent* of whether the code</span>
<span class="sd">            is run in graph or eager execution, but requires all operations that are dynamic to be `tf.*` operations.</span>
<span class="sd">            For example, multiplying by a constant (constant as in *not chaning ever*) does not require the constant to</span>
<span class="sd">            be a `tf.constant(...)` but can be a Python scalar. For example, it is also fine to use a fixed template shape</span>
<span class="sd">            using Numpy (Scipy etc), as the template shape will stay constant (this requires though to use a</span>
<span class="sd">            `z.py_function` to work, but this is another story about graph mode or not).</span>

<span class="sd">            To allow to have dynamic numpy operations in a component, preferably wrapped with `z.py_function` instead of</span>
<span class="sd">            forced eager, and to still retrieve a meaningful gradient, a numerical gradient has to be used.</span>
<span class="sd">            In general, this can be achieved by setting the `autograd` to False. Any derivative received will then be</span>
<span class="sd">            numerically computed. Furthermore, some minimizers (e.g. :py:class:`~zfit.minimize.Minuit`) have their own way</span>
<span class="sd">            of calculating gradients, which can be faster.</span>
<span class="sd">            Disabling `autograd` and using the zfit builting numerical way of calculating the gradients and hessian can</span>
<span class="sd">            be less stable and may raises errors.</span>

<span class="sd">            Args:</span>
<span class="sd">                autograd: Whether the automatic gradient feature of TensorFlow should be used or a numerical procedure</span>
<span class="sd">                  instead. If any non-constant Python (numpy, scipy,...) code is used inside, this should be switched on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TemporarilySet</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">autograd</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_autograd_mode</span><span class="p">,</span> <span class="n">getter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_autograd_mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunManager.set_mode"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.set_mode">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Use `set_graph_mode` or `set_autograd_mode`.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">autograd</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED! Use `set_graph_mode` or `set_autograd_mode`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">autograd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_autograd_mode</span><span class="p">(</span><span class="n">autograd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_graph_mode</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_set_autograd_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">autograd</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">autograd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">zfit</span> <span class="kn">import</span> <span class="n">settings</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">numerical_grad</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">autograd</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">[</span><span class="s1">&#39;autograd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">autograd</span>

    <span class="k">def</span> <span class="nf">_set_graph_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.graph</span> <span class="kn">import</span> <span class="n">jit</span> <span class="k">as</span> <span class="n">jit_obj</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">jit_obj</span><span class="o">.</span><span class="n">_set_all</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">jit_obj</span><span class="o">.</span><span class="n">_set_all</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">graph</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">jit_obj</span><span class="o">.</span><span class="n">_set_default</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">jit_obj</span><span class="o">.</span><span class="n">_update_allowed</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">graph</span><span class="si">}</span><span class="s2"> is not a valid keyword to the `jit` behavior. Use either &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;True, False, &#39;default&#39; or a dict. You can read more about it in the docs.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span>

<div class="viewcode-block" id="RunManager.get_graph_mode"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.get_graph_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_graph_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return the current policy for graph building.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool, str: The current policy. For more information, check :py:meth:`~zfit.run.set_mode`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RunManager.current_policy_graph"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.current_policy_graph">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Use `get_graph_mode` instead.&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">current_policy_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;DEPRECEATED! Use `get_graph_mode` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph_mode</span><span class="p">()</span></div>

<div class="viewcode-block" id="RunManager.get_autograd_mode"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.get_autograd_mode">[docs]</a>    <span class="k">def</span> <span class="nf">get_autograd_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The current policy for using the automatic gradient or falling back to the numerical</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: If autograd is being used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">[</span><span class="s1">&#39;autograd&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="RunManager.current_policy_autograd"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.current_policy_autograd">[docs]</a>    <span class="k">def</span> <span class="nf">current_policy_autograd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED! Use `get_autograd_mode` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_autograd_mode</span><span class="p">()</span></div>

<div class="viewcode-block" id="RunManager.set_mode_default"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.set_mode_default">[docs]</a>    <span class="k">def</span> <span class="nf">set_mode_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the mode to the default of `graph` = &#39;auto&#39; and `autograd` = True.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_MODE</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunManager.clear_graph_cache"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.clear_graph_cache">[docs]</a>    <span class="k">def</span> <span class="nf">clear_graph_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all generated graphs and effectively reset. Should not affect execution, only performance.</span>

<span class="sd">        In a simple fit scenario, this is not used. But if several fits are performed with different python objects</span>
<span class="sd">        such as a scan over a range (by changing the norm_range and creating a new dataset), doing minimization and</span>
<span class="sd">        therefore invoking the loss (by default creating a graph) will leave the graphs in the cache, even tough</span>
<span class="sd">        the already scanned ranges are not needed anymore.</span>

<span class="sd">        To clean, this function can be invoked. The only effect should be to speed up things, but should not have</span>
<span class="sd">        any side-effects other than that.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">zfit.util.cache</span> <span class="kn">import</span> <span class="n">clear_graph_cache</span>
        <span class="n">clear_graph_cache</span><span class="p">()</span></div>

<div class="viewcode-block" id="RunManager.assert_executing_eagerly"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.assert_executing_eagerly">[docs]</a>    <span class="k">def</span> <span class="nf">assert_executing_eagerly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assert that the execution is eager and Python side effects are taken into account.</span>

<span class="sd">        This can be placed inside a model _in case python side-effects are necessary_ and no other way is possible.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;This code is not supposed to run inside a graph.&quot;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Use `current_policy_graph() is False`&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">experimental_is_eager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="RunManager.experimental_clear_caches"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.RunManager.experimental_clear_caches">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;Use clear_graph_caches instead.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">experimental_clear_caches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DEPRECATED! Use `clear_graph_caches` instead.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_graph_cache</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="eval_object"><a class="viewcode-back" href="../../../full_api/zfit.util.execution.html#zfit.util.execution.eval_object">[docs]</a><span class="k">def</span> <span class="nf">eval_object</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">zfit.core.parameter</span> <span class="kn">import</span> <span class="n">BaseComposedParameter</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">BaseComposedParameter</span><span class="p">):</span>  <span class="c1"># currently no numpy attribute. Should we add this?</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tf</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright Copyright 2018, zfit.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>