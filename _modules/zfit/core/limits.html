

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>zfit.core.limits &mdash; zfit 0.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> zfit
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Zfit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zfit.pdf.html">zfit.pdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zfit.func.html">zfit.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zfit.data.html">zfit.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zfit.minimize.html">zfit.minimize</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zfit.loss.html">zfit.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zfit.constraint.html">zfit.constraint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zfit.ztf.html">zfit.ztf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">zfit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>zfit.core.limits</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for zfit.core.limits</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. include:: ../../docs/subst_types.rst</span>

<span class="sd"># NamedSpace and limits</span>

<span class="sd">Limits define a certain interval in a specific dimension. This can be used to define, for example,</span>
<span class="sd">the limits of an integral over several dimensions or a normalization range.</span>



<span class="sd">### with limits</span>

<span class="sd">Therefore a different way of specifying limits is possible, basically by defining chunks of the</span>
<span class="sd">lower and the upper limits. The shape of a lower resp. upper limit is (n_limits, n_obs).</span>

<span class="sd">Example: 1-dim: 1 to 4, 2.-dim: 21 to 24 AND 1.-dim: 6 to 7, 2.-dim 26 to 27</span>
<span class="sd">&gt;&gt;&gt; lower = ((1, 21), (6, 26))</span>
<span class="sd">&gt;&gt;&gt; upper = ((4, 24), (7, 27))</span>
<span class="sd">&gt;&gt;&gt; limits2 = Space(limits=(lower, upper), obs=(&#39;obs1&#39;, &#39;obs2&#39;)</span>

<span class="sd">General form:</span>

<span class="sd">lower = ((lower1_dim1, lower1_dim2, lower1_dim3), (lower2_dim1, lower2_dim2, lower2_dim3),...)</span>
<span class="sd">upper = ((upper1_dim1, upper1_dim2, upper1_dim3), (upper2_dim1, upper2_dim2, upper2_dim3),...)</span>

<span class="sd">## Using :py:class:`NamedSpace`</span>

<span class="sd">:py:class:`NamedSpace` offers a few useful functions to easier deal with the intervals</span>

<span class="sd">### Handling areas</span>

<span class="sd">For example when doing a MC integration using the expectation value, it is mandatory to know</span>
<span class="sd">the total area of your intervals. You can retrieve the total area or (if multiple limits (=intervals</span>
<span class="sd"> are given) the area of each interval.</span>

<span class="sd"> &gt;&gt;&gt; area = limits2.area()</span>
<span class="sd"> &gt;&gt;&gt; area_1, area_2 = limits2.iter_areas(rel=False)  # if rel is True, return the fraction of 1</span>


<span class="sd">### Retrieve the limits</span>

<span class="sd">&gt;&gt;&gt; lower, upper = limits2.limits</span>

<span class="sd">which you can now iterate through. For example, to calc an integral (assuming there is a function</span>
<span class="sd">`integrate` taking the lower and upper limits and returning the function), you can do</span>
<span class="sd">&gt;&gt;&gt; def integrate(lower_limit, upper_limit): return 42  # dummy function</span>
<span class="sd">&gt;&gt;&gt; integral = sum(integrate(lower_limit=low, upper_limit=up) for low, up in zip(lower, upper))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># TODO(Mayou36): update docs above</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pep487</span>

<span class="kn">from</span> <span class="nn">.dimension</span> <span class="k">import</span> <span class="n">add_spaces</span><span class="p">,</span> <span class="n">combine_spaces</span>
<span class="kn">from</span> <span class="nn">.baseobject</span> <span class="k">import</span> <span class="n">BaseObject</span>
<span class="kn">from</span> <span class="nn">.interfaces</span> <span class="k">import</span> <span class="n">ZfitSpace</span>
<span class="kn">from</span> <span class="nn">..util</span> <span class="k">import</span> <span class="n">ztyping</span>
<span class="kn">from</span> <span class="nn">..util.checks</span> <span class="k">import</span> <span class="n">NOT_SPECIFIED</span>
<span class="kn">from</span> <span class="nn">..util.container</span> <span class="k">import</span> <span class="n">convert_to_container</span>
<span class="kn">from</span> <span class="nn">..util.exception</span> <span class="k">import</span> <span class="p">(</span><span class="n">AxesNotSpecifiedError</span><span class="p">,</span> <span class="n">IntentionNotUnambiguousError</span><span class="p">,</span> <span class="n">LimitsUnderdefinedError</span><span class="p">,</span>
                              <span class="n">MultipleLimitsNotImplementedError</span><span class="p">,</span> <span class="n">NormRangeNotImplementedError</span><span class="p">,</span> <span class="n">ObsNotSpecifiedError</span><span class="p">,</span>
                              <span class="n">OverdefinedError</span><span class="p">,</span> <span class="n">LimitsNotSpecifiedError</span><span class="p">,</span> <span class="p">)</span>
<span class="kn">from</span> <span class="nn">..util.temporary</span> <span class="k">import</span> <span class="n">TemporarilySet</span>


<span class="c1"># Singleton</span>
<div class="viewcode-block" id="Any"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Any">[docs]</a><span class="k">class</span> <span class="nc">Any</span><span class="p">(</span><span class="n">pep487</span><span class="o">.</span><span class="n">PEP487Object</span><span class="p">):</span>  <span class="c1"># pep487 for _init_subclass backport</span>
    <span class="n">_singleton_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_singleton_instance</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_singleton_instance</span> <span class="o">=</span> <span class="n">instance</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_singleton_instance</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># each subclass is a singleton of &quot;itself&quot;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;Any&gt;&#39;</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># def __eq__(self, other):</span>
    <span class="c1">#     return True</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="c1"># def __hash__(self):</span>
    <span class="c1">#     return</span>


<div class="viewcode-block" id="AnyLower"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.AnyLower">[docs]</a><span class="k">class</span> <span class="nc">AnyLower</span><span class="p">(</span><span class="n">Any</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;Any Lower Limit&gt;&#39;</span>

    <span class="c1"># def __eq__(self, other):</span>
    <span class="c1">#     return False</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="AnyUpper"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.AnyUpper">[docs]</a><span class="k">class</span> <span class="nc">AnyUpper</span><span class="p">(</span><span class="n">Any</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;Any Upper Limit&gt;&#39;</span>

    <span class="c1"># def __eq__(self, other):</span>
    <span class="c1">#     return False</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<span class="n">ANY</span> <span class="o">=</span> <span class="n">Any</span><span class="p">()</span>
<span class="n">ANY_LOWER</span> <span class="o">=</span> <span class="n">AnyLower</span><span class="p">()</span>
<span class="n">ANY_UPPER</span> <span class="o">=</span> <span class="n">AnyUpper</span><span class="p">()</span>


<div class="viewcode-block" id="Space"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space">[docs]</a><span class="k">class</span> <span class="nc">Space</span><span class="p">(</span><span class="n">ZfitSpace</span><span class="p">,</span> <span class="n">BaseObject</span><span class="p">):</span>
    <span class="n">AUTO_FILL</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
    <span class="n">ANY</span> <span class="o">=</span> <span class="n">ANY</span>
    <span class="n">ANY_LOWER</span> <span class="o">=</span> <span class="n">ANY_LOWER</span>  <span class="c1"># TODO: needed? or move everything inside?</span>
    <span class="n">ANY_UPPER</span> <span class="o">=</span> <span class="n">ANY_UPPER</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeInput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Space&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define a space with the name (`obs`) of the axes (and it&#39;s number) and possibly it&#39;s limits.</span>

<span class="sd">        Args:</span>
<span class="sd">            obs (str, List[str,...]):</span>
<span class="sd">            limits ():</span>
<span class="sd">            name (str):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_obs</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NamedSpace_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_set_limits</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_any</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeInput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_space</span> <span class="o">=</span> <span class="n">Space</span><span class="o">.</span><span class="n">from_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_space</span> <span class="o">=</span> <span class="n">Space</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="n">new_space</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="k">return</span> <span class="n">new_space</span>

<div class="viewcode-block" id="Space.from_axes"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.from_axes">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_axes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span><span class="p">,</span>
                  <span class="n">limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeInput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a space from `axes` instead of from `obs`.</span>

<span class="sd">        Args:</span>
<span class="sd">            axes ():</span>
<span class="sd">            limits ():</span>
<span class="sd">            name (str):</span>

<span class="sd">        Returns:</span>
<span class="sd">            Space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AxesNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;Axes cannot be `None`&quot;</span><span class="p">)</span>
        <span class="n">fake_obs</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>  <span class="c1"># in order to create an instance</span>

        <span class="n">new_space</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">fake_obs</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">new_space</span><span class="o">.</span><span class="n">_obs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">new_space</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="n">new_space</span><span class="o">.</span><span class="n">_check_convert_input_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_space</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_obs_to_str</span><span class="p">(</span><span class="n">obs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_axes_to_int</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">axes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">_check_set_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeInput</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">limits</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_lower_upper</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">limits</span>

    <span class="k">def</span> <span class="nf">_check_convert_input_lower_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>

        <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_limit</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">lower</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_limit</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>
        <span class="n">lower_is_iterable</span> <span class="o">=</span> <span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span>
        <span class="n">upper_is_iterable</span> <span class="o">=</span> <span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lower_is_iterable</span> <span class="ow">or</span> <span class="n">upper_is_iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">upper</span><span class="p">:</span>
            <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower and upper limits wrong:&quot;</span>
                       <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower = </span><span class="si">{lower}</span><span class="s2">&quot;</span>
                       <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">upper = </span><span class="si">{upper}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">lower_is_iterable</span> <span class="o">^</span> <span class="n">upper_is_iterable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower and upper limits wrong:&quot;</span>
                             <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower = </span><span class="si">{l}</span><span class="s2">&quot;</span>
                             <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">upper = </span><span class="si">{u}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">upper</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">lower_is_iterable</span> <span class="ow">and</span> <span class="n">upper_is_iterable</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lower</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower and/or upper limits invalid:&quot;</span>
                                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower: </span><span class="si">{lower}</span><span class="s2">&quot;</span>
                                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">upper: </span><span class="si">{upper}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lower</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Limits shape not compatible with number of obs/axes&quot;</span>
                                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower: </span><span class="si">{lower}</span><span class="s2">&quot;</span>
                                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">upper: </span><span class="si">{upper}</span><span class="s2">&quot;</span>
                                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">n_obs: </span><span class="si">{n_obs}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span> <span class="n">n_obs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>

    <span class="k">def</span> <span class="nf">_check_convert_input_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">LowerTypeInput</span><span class="p">,</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">UpperTypeInput</span><span class="p">],</span>
                                   <span class="n">replace</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">LowerTypeReturn</span><span class="p">,</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">UpperTypeReturn</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Check and sanitize the lower or upper limit.</span>

<span class="sd">        Args:</span>
<span class="sd">            limit ():</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">replace</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">replace</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">replace</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="n">NOT_SPECIFIED</span> <span class="ow">or</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Currently, () is not supported as limits. Should this be default for None?&quot;</span><span class="p">)</span>
        <span class="c1"># TODO(Mayou36): allow automatically correct shape? Up to which extend?</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="p">((</span><span class="n">limit</span><span class="p">,),)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape of limit </span><span class="si">{}</span><span class="s2"> wrong.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>

        <span class="c1"># replace</span>
        <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">replace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lim</span><span class="p">)</span> <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">limit</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">limit</span>

    <span class="k">def</span> <span class="nf">_check_set_lower_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">LowerTypeInput</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">UpperTypeInput</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">lower</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_limit</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_limit</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_set_limits</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_convert_input_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span><span class="p">,</span>
                                  <span class="n">allow_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeReturn</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AxesNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;TODO: Cannot be None&quot;</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>  <span class="c1"># TODO(Mayou36): extend like _check_obs?</span>
        <span class="k">return</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">_check_convert_input_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span><span class="p">,</span>
                                 <span class="n">allow_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeReturn</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Input check: Convert `NOT_SPECIFIED` to None or check if obs are all strings.</span>

<span class="sd">        Args:</span>
<span class="sd">            obs (str, List[str], None, NOT_SPECIFIED):</span>

<span class="sd">        Returns:</span>
<span class="sd">            type:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ObsNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;TODO: Cannot be None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
            <span class="n">obs_not_str</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">obs_not_str</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The following observables are not strings: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs_not_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">limits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeReturn</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the limits.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lower</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">LowerTypeReturn</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the lower limits.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span>
        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">limits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">upper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">UpperTypeReturn</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the upper limits.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span>
        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">limits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># TODO(naming): better name? Like rank?</span>
        <span class="sd">&quot;&quot;&quot;Return the number of observables/axes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int &gt;= 1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">length</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The number of different limits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int &gt;= 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">obs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeReturn</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The observables (&quot;axes with str&quot;)the space is defined in.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeReturn</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The axes (&quot;obs with int&quot;) the space is defined in.</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span>

<div class="viewcode-block" id="Space.get_axes"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.get_axes">[docs]</a>    <span class="k">def</span> <span class="nf">get_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">autofill</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeReturn</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Return the axes corresponding to the `obs` (or all if None).</span>

<span class="sd">        Args:</span>
<span class="sd">            obs ():</span>
<span class="sd">            as_dict (bool): If True, returns a ordered dictionary with {obs: axis}</span>
<span class="sd">            autofill (bool): If True and the axes are not specified, automatically fill</span>
<span class="sd">                them with the default numbering and return (not setting them).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple, OrderedDict</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the requested `obs` do not match with the one defined in the range</span>
<span class="sd">            AxesNotSpecifiedError: If the axes in this `Space` have not been specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check input</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_obs</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">autofill</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AxesNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;The axes have not been specified&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">missing_obs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The requested observables </span><span class="si">{mis}</span><span class="s2"> are not contained in the defined &quot;</span>
                                 <span class="s2">&quot;observables </span><span class="si">{obs}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mis</span><span class="o">=</span><span class="n">missing_obs</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span>
        <span class="k">if</span> <span class="n">as_dict</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">o</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">axes</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Space.iter_limits"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.iter_limits">[docs]</a>    <span class="k">def</span> <span class="nf">iter_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_tuple</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">_IterLimitsTypeReturn</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the limits, either as `Space` objects or as pure limits-tuple.</span>

<span class="sd">        This makes iterating over limits easier: `for limit in space.iter_limits()`</span>
<span class="sd">        allows to, for example, pass `limit` to a function that can deal with simple limits</span>
<span class="sd">        only or if `as_tuple` is True the `limit` can be directly used to calculate something.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            for lower, upper in space.iter_limits(as_tuple=True):</span>
<span class="sd">                integrals = integrate(lower, upper)  # calculate integral</span>
<span class="sd">            integral = sum(integrals)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Space] or List[limit,...]:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LimitsNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;Space does not have limits, cannot iterate over them.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_tuple</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">space_objects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_limits</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">lower</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower</span><span class="p">,)</span>
                    <span class="n">upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper</span><span class="p">,)</span>
                    <span class="n">limit</span> <span class="o">=</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">limit</span> <span class="o">=</span> <span class="n">lower</span>
                <span class="n">space</span> <span class="o">=</span> <span class="n">Space</span><span class="o">.</span><span class="n">_from_any</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
                <span class="n">space_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">space_objects</span><span class="p">)</span></div>

<div class="viewcode-block" id="Space.with_limits"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.with_limits">[docs]</a>    <span class="k">def</span> <span class="nf">with_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeInput</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of the space with the new `limits` (and the new `name`).</span>

<span class="sd">        Args:</span>
<span class="sd">            limits ():</span>
<span class="sd">            name (str):</span>

<span class="sd">        Returns:</span>
<span class="sd">            Space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_space</span></div>

<div class="viewcode-block" id="Space.with_obs"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.with_obs">[docs]</a>    <span class="k">def</span> <span class="nf">with_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sort by `obs` and return the new instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            obs ():</span>

<span class="sd">        Returns:</span>
<span class="sd">            `Space`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_obs_to_str</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">new_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reorder_indices</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">new_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder_by_indices</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">new_indices</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_space</span></div>

<div class="viewcode-block" id="Space.with_axes"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.with_axes">[docs]</a>    <span class="k">def</span> <span class="nf">with_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sort by `obs` and return the new instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            axes ():</span>

<span class="sd">        Returns:</span>
<span class="sd">            `Space`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: what if self.axes is None? Just add them?</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_axes_to_int</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">new_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reorder_indices</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">new_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_space</span><span class="o">.</span><span class="n">reorder_by_indices</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">new_indices</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_space</span></div>

<div class="viewcode-block" id="Space.get_reorder_indices"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.get_reorder_indices">[docs]</a>    <span class="k">def</span> <span class="nf">get_reorder_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">axes</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Indices that would order `self.obs` as `obs` respectively `self.axes` as `axes`.</span>

<span class="sd">        Args:</span>
<span class="sd">            obs ():</span>
<span class="sd">            axes ():</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obs_none</span> <span class="o">=</span> <span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">axes_none</span> <span class="o">=</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="n">obs_is_defined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">obs_none</span>
        <span class="n">axes_is_defined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">axes_none</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">obs_is_defined</span> <span class="ow">or</span> <span class="n">axes_is_defined</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Neither the `obs` nor `axes` are defined.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obs_is_defined</span><span class="p">:</span>
            <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>

        <span class="n">new_indices</span> <span class="o">=</span> <span class="n">_reorder_indices</span><span class="p">(</span><span class="n">old</span><span class="o">=</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_indices</span></div>

<div class="viewcode-block" id="Space.reorder_by_indices"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.reorder_by_indices">[docs]</a>    <span class="k">def</span> <span class="nf">reorder_by_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Return a `Space` reordered by the indices.</span>

<span class="sd">        Args:</span>
<span class="sd">            indices ():</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_space</span><span class="o">.</span><span class="n">_reorder_limits</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">new_space</span><span class="o">.</span><span class="n">_reorder_axes</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">new_space</span><span class="o">.</span><span class="n">_reorder_obs</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_space</span></div>

    <span class="k">def</span> <span class="nf">_reorder_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeReturn</span><span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span>
        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>

            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">limits</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span> <span class="k">for</span> <span class="n">lower</span> <span class="ow">in</span> <span class="n">lower</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span> <span class="k">for</span> <span class="n">upper</span> <span class="ow">in</span> <span class="n">upper</span><span class="p">)</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="k">return</span> <span class="n">limits</span>

    <span class="k">def</span> <span class="nf">_reorder_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeReturn</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="k">return</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">_reorder_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeReturn</span><span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obs</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="k">return</span> <span class="n">obs</span>

<div class="viewcode-block" id="Space.get_obs_axes"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.get_obs_axes">[docs]</a>    <span class="k">def</span> <span class="nf">get_obs_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ObsNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;Obs not specified, cannot create `obs_axes`&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AxesNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;Axes not specified, cannot create `obs_axes`&quot;</span><span class="p">)</span>

        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_obs</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OverdefinedError</span><span class="p">(</span><span class="s2">&quot;Cannot use `obs` and `axes` to define which subset to access.&quot;</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">obs</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">axes</span>
        <span class="c1"># only membership testing below</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>

        <span class="c1"># create obs_axes dict</span>
        <span class="n">obs_axes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">o</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_axes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span> <span class="ow">or</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obs_axes</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">obs_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">o</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_obs_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_axes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">ordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">allow_subset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(Reorder) set the observables and the `axes`.</span>

<span class="sd">        Temporarily if used with a context manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            obs_axes (OrderedDict[str, int]): An (ordered) dict with {obs: axes}.</span>
<span class="sd">            allow_subset ():</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ordered</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_axes</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">IntentionNotUnambiguousError</span><span class="p">(</span><span class="s2">&quot;`ordered` is True but not an `OrderedDict` was given.&quot;</span>
                                               <span class="s2">&quot;Error due to safety (in Python &lt;3.7, dicts are not guaranteed to be&quot;</span>
                                               <span class="s2">&quot;ordered).&quot;</span><span class="p">)</span>
        <span class="n">tmp_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">obs_axes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">self_obs_set</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">tmp_obs</span><span class="p">)</span>
        <span class="n">tmp_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">obs_axes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">self_axes_set</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">tmp_axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ordered</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">obs_axes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">self_obs_set</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TODO observables not contained&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_subset</span> <span class="ow">and</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">obs_axes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">self_obs_set</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;subset not allowed but `obs` is only a subset of `self.obs`&quot;</span><span class="p">)</span>
                <span class="n">permutation_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs_axes</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">self_obs_set</span><span class="p">)</span>  <span class="c1"># the future index of the space</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">obs_axes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">self_axes_set</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TODO axes not contained&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_subset</span> <span class="ow">and</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">obs_axes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">self_axes_set</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;subset not allowed but `axes` is only a subset of `self.axes`&quot;</span><span class="p">)</span>
                <span class="n">permutation_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">obs_axes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span>
                    <span class="n">ax</span> <span class="ow">in</span> <span class="n">self_axes_set</span><span class="p">)</span>  <span class="c1"># the future index of the space</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;This should never be reached.&quot;</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reorder_limits</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="n">permutation_index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs_axes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">self_obs_set</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ax</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">obs_axes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">self_axes_set</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_subset</span> <span class="ow">and</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">obs_axes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">self_obs_set</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;subset not allowed TODO&quot;</span><span class="p">)</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">obs_axes</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_subset</span> <span class="ow">and</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">obs_axes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">self_axes_set</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;subset not allowed TODO&quot;</span><span class="p">)</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>
                <span class="n">axes_obs</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obs_axes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axes_obs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `obs` or `axes` have to be specified if the `obs_axes` dict&quot;</span>
                                 <span class="s2">&quot;is not ordered and `ordered` is False.&quot;</span><span class="p">)</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">limits</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">axes</span>

        <span class="k">def</span> <span class="nf">setter</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
            <span class="n">limits</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">arguments</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_check_set_limits</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obs</span> <span class="o">=</span> <span class="n">obs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="n">axes</span>

        <span class="k">def</span> <span class="nf">getter</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>

        <span class="k">return</span> <span class="n">TemporarilySet</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">,</span> <span class="n">getter</span><span class="o">=</span><span class="n">getter</span><span class="p">)</span>

<div class="viewcode-block" id="Space.with_obs_axes"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.with_obs_axes">[docs]</a>    <span class="k">def</span> <span class="nf">with_obs_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_axes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">ordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">allow_subset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a new `Space` with reordered observables and set the `axes`.</span>


<span class="sd">        Args:</span>
<span class="sd">            obs_axes (OrderedDict[str, int]): An ordered dict with {obs: axes}.</span>
<span class="sd">            ordered (bool): If True (and the `obs_axes` is an `OrderedDict`), the</span>
<span class="sd">            allow_subset ():</span>

<span class="sd">        Returns:</span>
<span class="sd">            Space:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_obs_axes</span><span class="p">(</span><span class="n">obs_axes</span><span class="o">=</span><span class="n">obs_axes</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">,</span> <span class="n">allow_subset</span><span class="o">=</span><span class="n">allow_subset</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Space.with_autofill_axes"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.with_autofill_axes">[docs]</a>    <span class="k">def</span> <span class="nf">with_autofill_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a `Space` with filled axes corresponding to range(len(n_obs)).</span>

<span class="sd">        Args:</span>
<span class="sd">            overwrite (bool): If `self.axes` is not None, replace the axes with the autofilled ones.</span>
<span class="sd">                If axes is already set, don&#39;t do anything if `overwrite` is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `Space`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">new_axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">))</span>
            <span class="n">new_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">new_axes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_space</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="n">new_space</span></div>

<div class="viewcode-block" id="Space.area"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.area">[docs]</a>    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the total area of all the limits and axes. Useful, for example, for MC integration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_areas</span><span class="p">(</span><span class="n">rel</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>

<div class="viewcode-block" id="Space.iter_areas"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.iter_areas">[docs]</a>    <span class="k">def</span> <span class="nf">iter_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return the areas of each interval</span>

<span class="sd">        Args:</span>
<span class="sd">            rel (bool): If True, return the relative fraction of each interval</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float]:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_areas</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rel</span><span class="p">:</span>
            <span class="n">areas</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">areas</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">areas</span></div>

    <span class="nd">@staticmethod</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_calculate_areas</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">up</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">low</span><span class="p">)))</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">limits</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">areas</span>

<div class="viewcode-block" id="Space.get_subspace"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.get_subspace">[docs]</a>    <span class="k">def</span> <span class="nf">get_subspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a `Space` consisting of only a subset of the `obs`/`axes` (only one allowed).</span>

<span class="sd">        Args:</span>
<span class="sd">            obs (str, Tuple[str]):</span>
<span class="sd">            axes (int, Tuple[int]):</span>
<span class="sd">            name ():</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify `obs` *and* `axes` to get subspace.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `obs` or `axes` has to be specified and not None&quot;</span><span class="p">)</span>

        <span class="c1"># try to use observables to get index</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_obs</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sub_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Cannot get subspace from `obs` </span><span class="si">{}</span><span class="s2"> as this observables are not defined&quot;</span>
                               <span class="s2">&quot;in this space.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">({</span><span class="nb">set</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">)}))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># `obs` is None -&gt; has not attribute `index`</span>
                <span class="k">raise</span> <span class="n">ObsNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;Observables have not been specified in this space.&quot;</span><span class="p">)</span>

        <span class="c1"># try to use axes to get index</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_convert_input_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sub_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Cannot get subspace from `axes` </span><span class="si">{}</span><span class="s2"> as this axes are not defined&quot;</span>
                               <span class="s2">&quot;in this space.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">({</span><span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)}))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AxesNotSpecifiedError</span><span class="p">(</span><span class="s2">&quot;Axes have not been specified for this space.&quot;</span><span class="p">)</span>

        <span class="n">sub_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sub_index</span><span class="p">)</span>
        <span class="n">sub_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sub_index</span><span class="p">)</span>

        <span class="c1"># use index to get limits</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span>
        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">sub_limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">limits</span>
            <span class="n">sub_lower</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sub_index</span><span class="p">)</span> <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">lower</span><span class="p">)</span>
            <span class="n">sub_upper</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sub_index</span><span class="p">)</span> <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">upper</span><span class="p">)</span>
            <span class="n">sub_limits</span> <span class="o">=</span> <span class="n">sub_lower</span><span class="p">,</span> <span class="n">sub_upper</span>

        <span class="n">new_space</span> <span class="o">=</span> <span class="n">Space</span><span class="o">.</span><span class="n">_from_any</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">sub_obs</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">sub_axes</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">sub_limits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_space</span></div>

    <span class="c1"># Operators</span>

<div class="viewcode-block" id="Space.copy"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">overwrite_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Space&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a new `Space` using the current attributes and overwriting with `overwrite_overwrite_kwargs`.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The new name. If not given, the new instance will be named the same as the</span>
<span class="sd">                current one.</span>
<span class="sd">            **overwrite_kwargs ():</span>

<span class="sd">        Returns:</span>
<span class="sd">            Space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                  <span class="s1">&#39;limits&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">,</span>
                  <span class="s1">&#39;axes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
                  <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">}</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">overwrite_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">overwrite_kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Not usable keys in `overwrite_kwargs`: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">overwrite_kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)))</span>

        <span class="n">new_space</span> <span class="o">=</span> <span class="n">Space</span><span class="o">.</span><span class="n">_from_any</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_space</span></div>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>  <span class="c1"># TODO: refactor for boundaries</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="n">axes_not_none</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">obs_not_none</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">axes_not_none</span> <span class="ow">or</span> <span class="n">obs_not_none</span><span class="p">):</span>  <span class="c1"># if both are None</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">axes_not_none</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">obs_not_none</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">obs</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># check limits</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="n">reorder_indices</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_reorder_indices</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">reorder_by_indices</span><span class="p">(</span><span class="n">reorder_indices</span><span class="p">)</span>

        <span class="c1"># check explicitly if they match</span>
        <span class="c1"># for each limit in self, find another matching in other</span>
        <span class="k">for</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_limits</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">limit_is_le</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">other_lower</span><span class="p">,</span> <span class="n">other_upper</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">iter_limits</span><span class="p">(</span><span class="n">as_tuple</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="c1"># each entry *has to* match the entry of the other limit, otherwise it&#39;s not the same</span>
                <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">other_low</span><span class="p">,</span> <span class="n">other_up</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">other_lower</span><span class="p">,</span> <span class="n">other_upper</span><span class="p">):</span>
                    <span class="n">axis_le</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># False</span>
                    <span class="n">axis_le</span> <span class="o">+=</span> <span class="n">other_low</span> <span class="o">==</span> <span class="n">low</span> <span class="ow">and</span> <span class="n">up</span> <span class="o">==</span> <span class="n">other_up</span>  <span class="c1"># TODO: approx limit comparison?</span>
                    <span class="n">axis_le</span> <span class="o">+=</span> <span class="n">other_low</span> <span class="o">==</span> <span class="n">low</span> <span class="ow">and</span> <span class="n">other_up</span> <span class="ow">is</span> <span class="n">ANY_UPPER</span>  <span class="c1"># TODO: approx limit</span>
                    <span class="c1"># comparison?</span>
                    <span class="n">axis_le</span> <span class="o">+=</span> <span class="n">other_low</span> <span class="ow">is</span> <span class="n">ANY_LOWER</span> <span class="ow">and</span> <span class="n">up</span> <span class="o">==</span> <span class="n">other_up</span>  <span class="c1"># TODO: approx limit</span>
                    <span class="c1"># comparison?</span>
                    <span class="n">axis_le</span> <span class="o">+=</span> <span class="n">other_low</span> <span class="ow">is</span> <span class="n">ANY_LOWER</span> <span class="ow">and</span> <span class="n">other_up</span> <span class="ow">is</span> <span class="n">ANY_UPPER</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">axis_le</span><span class="p">:</span>  <span class="c1"># if not the same, don&#39;t test other dims</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">limit_is_le</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># no break -&gt; all axes coincide</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">limit_is_le</span><span class="p">:</span>  <span class="c1"># for this `limit`, no other_limit matched</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="Space.add"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">SpaceOrSpacesTypeInput</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the limits of the spaces. Only works for the same obs.</span>

<span class="sd">        In case the observables are different, the order of the first space is taken.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (`Space`):</span>

<span class="sd">        Returns:</span>
<span class="sd">            `zfit.Space`: &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">new_space</span> <span class="o">=</span> <span class="n">add_spaces</span><span class="p">([</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_space</span></div>

<div class="viewcode-block" id="Space.combine"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.Space.combine">[docs]</a>    <span class="k">def</span> <span class="nf">combine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ztyping</span><span class="o">.</span><span class="n">SpaceOrSpacesTypeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ZfitSpace</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Combine spaces with different obs (but consistent limits).</span>

<span class="sd">        Args:</span>
<span class="sd">            other (zfit.Space):</span>

<span class="sd">        Returns:</span>
<span class="sd">            zfit.Space:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">new_space</span> <span class="o">=</span> <span class="n">combine_spaces</span><span class="p">([</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_space</span></div>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ZfitSpace</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot add a </span><span class="si">{}</span><span class="s2"> and a </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)):</span>  <span class="c1"># TODO(Mayou36): what is a proper comparison?</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="n">is_eq</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">is_eq</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">obs</span>
        <span class="n">is_eq</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">axes</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">is_eq</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">limits</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">is_eq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>  <span class="c1"># we want to be non-restrictive: it&#39;s just a hash, not the __eq__</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">lower</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">upper</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">upper</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">))</span></div>


<span class="c1"># TODO(Mayou36): extend this function and set what is allowed and what not, allow for simple limits?</span>
<div class="viewcode-block" id="convert_to_space"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.convert_to_space">[docs]</a><span class="k">def</span> <span class="nf">convert_to_space</span><span class="p">(</span><span class="n">obs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">ObsTypeInput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">AxesTypeInput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">limits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ztyping</span><span class="o">.</span><span class="n">LimitsTypeInput</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="o">*</span><span class="p">,</span> <span class="n">overwrite_limits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">one_dim_limits_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">simple_limits_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Space</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Convert *limits* to a Space object if not already None or False.</span>

<span class="sd">    Args:</span>
<span class="sd">        obs (Union[Tuple[float, float], zfit.core.limits.Space]):</span>
<span class="sd">        limits ():</span>
<span class="sd">        axes ():</span>
<span class="sd">        overwrite_limits (bool): If `obs` or `axes` is a `Space` _and_ `limits` are given, return an instance</span>
<span class="sd">            of `Space` with the new limits. If the flag is `False`, the `limits` argument will be ignored if</span>
<span class="sd">        one_dim_limits_only (bool):</span>
<span class="sd">        simple_limits_only (bool):</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Space, False, None]:</span>

<span class="sd">    Raises:</span>
<span class="sd">        OverdefinedError: if `obs` or `axes` is a `Space` and `axes` respectively `obs` is not `None`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">space</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Test if already `Space` and handle</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OverdefinedError</span><span class="p">(</span><span class="s2">&quot;if `obs` is a `Space`, `axes` cannot be defined.&quot;</span><span class="p">)</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">obs</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OverdefinedError</span><span class="p">(</span><span class="s2">&quot;if `axes` is a `Space`, `obs` cannot be defined.&quot;</span><span class="p">)</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">axes</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">limits</span>
    <span class="k">if</span> <span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># set the limits if given</span>
        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">overwrite_limits</span> <span class="ow">or</span> <span class="n">space</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>  <span class="c1"># figure out if compatible if limits is `Space`</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">limits</span><span class="o">.</span><span class="n">obs</span> <span class="o">==</span> <span class="n">space</span><span class="o">.</span><span class="n">obs</span> <span class="ow">or</span>
                        <span class="p">(</span><span class="n">limits</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="n">space</span><span class="o">.</span><span class="n">axes</span> <span class="ow">and</span> <span class="n">limits</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">space</span><span class="o">.</span><span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">IntentionNotUnambiguousError</span><span class="p">(</span>
                        <span class="s2">&quot;`obs`/`axes` is a `Space` as well as the `limits`, but the &quot;</span>
                        <span class="s2">&quot;obs/axes of them do not match&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">limits</span>

            <span class="n">space</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">with_limits</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">space</span>

    <span class="c1"># space is None again</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">obs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># check if limits are allowed</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">Space</span><span class="o">.</span><span class="n">_from_any</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">)</span>  <span class="c1"># create and test if valid</span>
        <span class="k">if</span> <span class="n">one_dim_limits_only</span> <span class="ow">and</span> <span class="n">space</span><span class="o">.</span><span class="n">n_obs</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">space</span><span class="o">.</span><span class="n">limits</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LimitsUnderdefinedError</span><span class="p">(</span>
                <span class="s2">&quot;Limits more sophisticated than 1-dim cannot be auto-created from tuples. Use `Space` instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">simple_limits_only</span> <span class="ow">and</span> <span class="n">space</span><span class="o">.</span><span class="n">limits</span> <span class="ow">and</span> <span class="n">space</span><span class="o">.</span><span class="n">n_limits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LimitsUnderdefinedError</span><span class="p">(</span><span class="s2">&quot;Limits with multiple limits cannot be auto-created&quot;</span>
                                          <span class="s2">&quot; from tuples. Use `Space` instead.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">space</span></div>


<span class="k">def</span> <span class="nf">_reorder_indices</span><span class="p">(</span><span class="n">old</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">],</span> <span class="n">new</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">new_indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_indices</span>


<div class="viewcode-block" id="no_norm_range"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.no_norm_range">[docs]</a><span class="k">def</span> <span class="nf">no_norm_range</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator: Catch the &#39;norm_range&#39; kwargs. If not None, raise NormRangeNotImplementedError.&quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="s1">&#39;norm_range&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">norm_range_index</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;norm_range&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">norm_range_index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">norm_range</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;norm_range&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm_range</span><span class="p">,</span> <span class="n">Space</span><span class="p">):</span>
            <span class="n">norm_range_not_false</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">norm_range</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">norm_range</span><span class="o">.</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm_range_not_false</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">norm_range</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">norm_range</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">norm_range_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">norm_range_is_arg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">norm_range_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm_range_is_arg</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;norm_range&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># remove if in signature (= norm_range_index not None)</span>
        <span class="k">if</span> <span class="n">norm_range_not_false</span> <span class="ow">or</span> <span class="n">norm_range_is_arg</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NormRangeNotImplementedError</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_func</span></div>


<div class="viewcode-block" id="no_multiple_limits"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.no_multiple_limits">[docs]</a><span class="k">def</span> <span class="nf">no_multiple_limits</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator: Catch the &#39;limits&#39; kwargs. If it contains multiple limits, raise MultipleLimitsNotImplementedError.&quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="s1">&#39;limits&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">limits_index</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;limits&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span>  <span class="c1"># no limits as parameters -&gt; no problem</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">limits_is_arg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limits_index</span>
        <span class="k">if</span> <span class="n">limits_is_arg</span><span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">limits_index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;limits&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">limits</span><span class="o">.</span><span class="n">n_limits</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MultipleLimitsNotImplementedError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_func</span></div>


<div class="viewcode-block" id="supports"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.supports">[docs]</a><span class="k">def</span> <span class="nf">supports</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">norm_range</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">multiple_limits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Decorator: Add (mandatory for some methods) on a method to control what it can handle.</span>

<span class="sd">    If any of the flags is set to False, it will check the arguments and, in case they match a flag</span>
<span class="sd">    (say if a *norm_range* is passed while the *norm_range* flag is set to `False`), it will</span>
<span class="sd">    raise a corresponding exception (in this example a `NormRangeNotImplementedError`) that will</span>
<span class="sd">    be catched by an earlier function that knows how to handle things.</span>

<span class="sd">    Args:</span>
<span class="sd">        norm_range (bool): If False, no norm_range argument will be passed through resp. will be `None`</span>
<span class="sd">        multiple_limits (bool): If False, only simple limits are to be expected and no iteration is</span>
<span class="sd">            therefore required.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">decorator_stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple_limits</span><span class="p">:</span>
        <span class="n">decorator_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">no_multiple_limits</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">norm_range</span><span class="p">:</span>
        <span class="n">decorator_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">no_norm_range</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_deco_stack</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">decorator</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">decorator_stack</span><span class="p">):</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">func</span><span class="o">.</span><span class="n">__wrapped__</span> <span class="o">=</span> <span class="n">supports</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">create_deco_stack</span></div>


<div class="viewcode-block" id="convert_to_obs_str"><a class="viewcode-back" href="../../../zfit.core.limits.html#zfit.convert_to_obs_str">[docs]</a><span class="k">def</span> <span class="nf">convert_to_obs_str</span><span class="p">(</span><span class="n">obs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert `obs` to the list of obs, also if it is a `Space`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">convert_to_container</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ob</span><span class="o">.</span><span class="n">obs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">Space</span><span class="p">)</span> <span class="k">else</span> <span class="n">obs</span> <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obs</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, zfit

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>